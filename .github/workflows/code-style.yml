name: Code Style
on:
    workflow_dispatch:
    pull_request:
    push:
        branches:
            - main

jobs:
    cs:
        if: github.event_name != 'schedule'
        uses: shopware/github-actions/.github/workflows/cs-fixer.yml@main
    get-matrix:
        runs-on: ubuntu-latest
        outputs:
            matrix: ${{ steps.matrix.outputs.matrix }}
        steps:
            -   name: Checkout repository
                uses: actions/checkout@v4

            -   name: Get Shopware Version
                id: shopware-constraint
                run: echo "shopware_constraint=$(cat composer.json | jq -r '.require."shopware/core"')" >> $GITHUB_OUTPUT

            -   name: Get Shopware Matrix
                uses: tinect/github-shopware-matrix-generator@main
                id: matrix
                with:
                    versionConstraint: ${{ steps.shopware-constraint.outputs.shopware_constraint }}
                    allowEol: false
                    justMinMaxShopware: false
                    allowShopwareNext: true
                    allowShopwareRC: false
    phpstan:
        name: PHPStan
        needs: get-matrix
        strategy:
            fail-fast: false
            matrix: ${{ fromJson(needs.get-matrix.outputs.matrix) }}
        uses: shopware/github-actions/.github/workflows/phpstan.yml@main
        with:
            extensionName: FroshTools
            shopwareVersion: ${{ matrix.shopware }}
